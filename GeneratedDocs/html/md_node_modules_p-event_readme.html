<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EOSDAC: p-event &lt;a href=&quot;https://travis-ci.com/sindresorhus/p-event&quot;&gt;&lt;img src=&quot;https://travis-ci.com/sindresorhus/p-event.svg?branch=master&quot; alt=&quot;Build Status&quot;/&gt;&lt;/a&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EOSDAC
   </div>
   <div id="projectbrief">Open source decentralised DAC platform for EOSIO blockchains</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_node_modules_p-event_readme.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">p-event <a href="https://travis-ci.com/sindresorhus/p-event"><img src="https://travis-ci.com/sindresorhus/p-event.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p>Promisify an event by waiting for it to be emitted </p>
</blockquote>
<p>Useful when you need only one event emission and want to use it with promises or await it in an async function.</p>
<p>It's works with any event API in Node.js and the browser (using a bundler).</p>
<p>If you want multiple individual events as they are emitted, you can use the <code>pEvent.iterator()</code> method. <a href="https://medium.com/@benlesh/learning-observable-by-building-observable-d5da57405d87">Observables</a> can be useful too.</p>
<h1><a class="anchor" id="autotoc_md3514"></a>
Install</h1>
<div class="fragment"><div class="line">$ npm install p-event</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3515"></a>
Usage</h1>
<p>In Node.js:</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line">const emitter = require(&#39;./some-event-emitter&#39;);</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    try {</div>
<div class="line">        const result = await pEvent(emitter, &#39;finish&#39;);</div>
<div class="line"> </div>
<div class="line">        // `emitter` emitted a `finish` event</div>
<div class="line">        console.log(result);</div>
<div class="line">    } catch (error) {</div>
<div class="line">        // `emitter` emitted an `error` event</div>
<div class="line">        console.error(error);</div>
<div class="line">    }</div>
<div class="line">})();</div>
</div><!-- fragment --><p>In the browser:</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    await pEvent(document, &#39;DOMContentLoaded&#39;);</div>
<div class="line">    console.log(&#39;ðŸ˜Ž&#39;);</div>
<div class="line">})();</div>
</div><!-- fragment --><p>Async iteration:</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line">const emitter = require(&#39;./some-event-emitter&#39;);</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    const asyncIterator = pEvent.iterator(emitter, &#39;data&#39;, {</div>
<div class="line">        resolutionEvents: [&#39;finish&#39;]</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    for await (const event of asyncIterator) {</div>
<div class="line">        console.log(event);</div>
<div class="line">    }</div>
<div class="line">})();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3516"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md3517"></a>
pEvent(emitter, event, options?)</h2>
<h2><a class="anchor" id="autotoc_md3518"></a>
pEvent(emitter, event, filter)</h2>
<p>Returns a <code>Promise</code> that is fulfilled when <code>emitter</code> emits an event matching <code>event</code>, or rejects if <code>emitter</code> emits any of the events defined in the <code>rejectionEvents</code> option.</p>
<p><b>Note</b>: <code>event</code> is a string for a single event type, for example, &lsquo;'data&rsquo;<code>. To listen on multiple events, pass an array of strings, such as</code>['started', 'stopped']`.</p>
<p>The returned promise has a <code>.<a class="el" href="referendum_8hpp.html#aec035695eedf7f3405161cd873d5875c">cancel()</a></code> method, which when called, removes the event listeners and causes the promise to never be settled.</p>
<h3><a class="anchor" id="autotoc_md3519"></a>
emitter</h3>
<p>Type: <code>object</code></p>
<p>Event emitter object.</p>
<p>Should have either a <code>.<a class="el" href="typescript_2_l_i_c_e_n_s_e_8txt.html#a99e0c7c6bd1082fe4cf97f0912e847d7">on()</a></code>/<code>.addListener()</code>/<code>.addEventListener()</code> and <code>.off()</code>/<code>.removeListener()</code>/<code>.removeEventListener()</code> method, like the <a href="https://nodejs.org/api/events.html">Node.js <code>EventEmitter</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/Events">DOM events</a>.</p>
<h3><a class="anchor" id="autotoc_md3520"></a>
event</h3>
<p>Type: <code>string | string[]</code></p>
<p>Name of the event or events to listen to.</p>
<p>If the same event is defined both here and in <code>rejectionEvents</code>, this one takes priority.</p>
<h3><a class="anchor" id="autotoc_md3521"></a>
options</h3>
<p>Type: <code>object</code></p>
<h4><a class="anchor" id="autotoc_md3522"></a>
rejectionEvents</h4>
<p>Type: <code>string[]</code>\ Default: &lsquo;['error&rsquo;]`</p>
<p>Events that will reject the promise.</p>
<h4><a class="anchor" id="autotoc_md3523"></a>
multiArgs</h4>
<p>Type: <code>boolean</code>\ Default: <code>false</code></p>
<p>By default, the promisified function will only return the first argument from the event callback, which works fine for most APIs. This option can be useful for APIs that return multiple arguments in the callback. Turning this on will make it return an array of all arguments from the callback, instead of just the first argument. This also applies to rejections.</p>
<p>Example:</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line">const emitter = require(&#39;./some-event-emitter&#39;);</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    const [foo, bar] = await pEvent(emitter, &#39;finish&#39;, {multiArgs: true});</div>
<div class="line">})();</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md3524"></a>
timeout</h4>
<p>Type: <code>number</code>\ Default: <code>Infinity</code></p>
<p>Time in milliseconds before timing out.</p>
<h4><a class="anchor" id="autotoc_md3525"></a>
filter</h4>
<p>Type: <code>Function</code></p>
<p>Filter function for accepting an event.</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line">const emitter = require(&#39;./some-event-emitter&#39;);</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    const result = await pEvent(emitter, &#39;ðŸ¦„&#39;, value =&gt; value &gt; 3);</div>
<div class="line">    // Do something with first ðŸ¦„ event with a value greater than 3</div>
<div class="line">})();</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3526"></a>
pEvent.multiple(emitter, event, options)</h2>
<p>Wait for multiple event emissions. Returns an array.</p>
<p>This method has the same arguments and options as <code>pEvent()</code> with the addition of the following options:</p>
<h3><a class="anchor" id="autotoc_md3527"></a>
options</h3>
<p>Type: <code>object</code></p>
<h4><a class="anchor" id="autotoc_md3528"></a>
count</h4>
<p><em>Required</em>\ Type: <code>number</code></p>
<p>The number of times the event needs to be emitted before the promise resolves.</p>
<h4><a class="anchor" id="autotoc_md3529"></a>
resolveImmediately</h4>
<p>Type: <code>boolean</code>\ Default: <code>false</code></p>
<p>Whether to resolve the promise immediately. Emitting one of the <code>rejectionEvents</code> won't throw an error.</p>
<p><b>Note</b>: The returned array will be mutated when an event is emitted.</p>
<p>Example:</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line"> </div>
<div class="line">const emitter = new EventEmitter();</div>
<div class="line"> </div>
<div class="line">const promise = pEvent.multiple(emitter, &#39;hello&#39;, {</div>
<div class="line">    resolveImmediately: true,</div>
<div class="line">    count: Infinity</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">const result = await promise;</div>
<div class="line">console.log(result);</div>
<div class="line">//=&gt; []</div>
<div class="line"> </div>
<div class="line">emitter.emit(&#39;hello&#39;, &#39;Jack&#39;);</div>
<div class="line">console.log(result);</div>
<div class="line">//=&gt; [&#39;Jack&#39;]</div>
<div class="line"> </div>
<div class="line">emitter.emit(&#39;hello&#39;, &#39;Mark&#39;);</div>
<div class="line">console.log(result);</div>
<div class="line">//=&gt; [&#39;Jack&#39;, &#39;Mark&#39;]</div>
<div class="line"> </div>
<div class="line">// Stops listening</div>
<div class="line">emitter.emit(&#39;error&#39;, new Error(&#39;ðŸ˜¿&#39;));</div>
<div class="line"> </div>
<div class="line">emitter.emit(&#39;hello&#39;, &#39;John&#39;);</div>
<div class="line">console.log(result);</div>
<div class="line">//=&gt; [&#39;Jack&#39;, &#39;Mark&#39;]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3530"></a>
pEvent.iterator(emitter, event, options?)</h2>
<h2><a class="anchor" id="autotoc_md3531"></a>
pEvent.iterator(emitter, event, filter)</h2>
<p>Returns an <a href="https://2ality.com/2016/10/asynchronous-iteration.html">async iterator</a> that lets you asynchronously iterate over events of <code>event</code> emitted from <code>emitter</code>. The iterator ends when <code>emitter</code> emits an event matching any of the events defined in <code>resolutionEvents</code>, or rejects if <code>emitter</code> emits any of the events defined in the <code>rejectionEvents</code> option.</p>
<p>This method has the same arguments and options as <code>pEvent()</code> with the addition of the following options:</p>
<h3><a class="anchor" id="autotoc_md3532"></a>
options</h3>
<p>Type: <code>object</code></p>
<h4><a class="anchor" id="autotoc_md3533"></a>
limit</h4>
<p>Type: <code>number</code> *(non-negative integer)*\ Default: <code>Infinity</code></p>
<p>Maximum number of events for the iterator before it ends. When the limit is reached, the iterator will be marked as <code>done</code>. This option is useful to paginate events, for example, fetching 10 events per page.</p>
<h4><a class="anchor" id="autotoc_md3534"></a>
resolutionEvents</h4>
<p>Type: <code>string[]</code>\ Default: <code>[]</code></p>
<p>Events that will end the iterator.</p>
<h2><a class="anchor" id="autotoc_md3535"></a>
pEvent.TimeoutError</h2>
<p>Exposed for instance checking and sub-classing.</p>
<p>Example:</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line"> </div>
<div class="line">try {</div>
<div class="line">    await pEvent(emitter, &#39;finish&#39;);</div>
<div class="line">} catch (error) {</div>
<div class="line">    if (error instanceof pEvent.TimeoutError) {</div>
<div class="line">        // Do something specific for timeout errors</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3536"></a>
Before and after</h1>
<div class="fragment"><div class="line">const fs = require(&#39;fs&#39;);</div>
<div class="line"> </div>
<div class="line">function getOpenReadStream(file, callback) {</div>
<div class="line">    const stream = fs.createReadStream(file);</div>
<div class="line"> </div>
<div class="line">    stream.on(&#39;open&#39;, () =&gt; {</div>
<div class="line">        callback(null, stream);</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    stream.on(&#39;error&#39;, error =&gt; {</div>
<div class="line">        callback(error);</div>
<div class="line">    });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">getOpenReadStream(&#39;unicorn.txt&#39;, (error, stream) =&gt; {</div>
<div class="line">    if (error) {</div>
<div class="line">        console.error(error);</div>
<div class="line">        return;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    console.log(&#39;File descriptor:&#39;, stream.fd);</div>
<div class="line">    stream.pipe(process.stdout);</div>
<div class="line">});</div>
</div><!-- fragment --><div class="fragment"><div class="line">const fs = require(&#39;fs&#39;);</div>
<div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line"> </div>
<div class="line">async function getOpenReadStream(file) {</div>
<div class="line">    const stream = fs.createReadStream(file);</div>
<div class="line">    await pEvent(stream, &#39;open&#39;);</div>
<div class="line">    return stream;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    const stream = await getOpenReadStream(&#39;unicorn.txt&#39;);</div>
<div class="line">    console.log(&#39;File descriptor:&#39;, stream.fd);</div>
<div class="line">    stream.pipe(process.stdout);</div>
<div class="line">})().catch(console.error);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3537"></a>
Tip</h1>
<h2><a class="anchor" id="autotoc_md3538"></a>
Dealing with calls that resolve with an error code</h2>
<p>Some functions might use a single event for success and for certain errors. Promises make it easy to have combined error handler for both error events and successes containing values which represent errors.</p>
<div class="fragment"><div class="line">const pEvent = require(&#39;p-event&#39;);</div>
<div class="line">const emitter = require(&#39;./some-event-emitter&#39;);</div>
<div class="line"> </div>
<div class="line">(async () =&gt; {</div>
<div class="line">    try {</div>
<div class="line">        const result = await pEvent(emitter, &#39;finish&#39;);</div>
<div class="line"> </div>
<div class="line">        if (result === &#39;unwanted result&#39;) {</div>
<div class="line">            throw new Error(&#39;Emitter finished with an error&#39;);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        // `emitter` emitted a `finish` event with an acceptable value</div>
<div class="line">        console.log(result);</div>
<div class="line">    } catch (error) {</div>
<div class="line">        // `emitter` emitted an `error` event or</div>
<div class="line">        // emitted a `finish` with &#39;unwanted result&#39;</div>
<div class="line">        console.error(error);</div>
<div class="line">    }</div>
<div class="line">})();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3539"></a>
Related</h1>
<ul>
<li><a href="https://github.com/sindresorhus/pify">pify</a> - Promisify a callback-style function</li>
<li><a href="https://github.com/sindresorhus/p-map">p-map</a> - Map over promises concurrently</li>
<li><a href="https://github.com/sindresorhus/promise-fun">Moreâ€¦</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
