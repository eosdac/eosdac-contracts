<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EOSDAC: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EOSDAC
   </div>
   <div id="projectbrief">Open source decentralised DAC platform for EOSIO blockchains</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_node_modules_chai-as-promised__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="http://promisesaplus.com/"><img src="https://promises-aplus.github.io/promises-spec/assets/logo-small.png" alt="Promises/A+ logo" align="right" valign="top" class="inline"/> </a></p>
<h1><a class="anchor" id="autotoc_md965"></a>
Chai Assertions for Promises</h1>
<p><b>Chai as Promised</b> extends <a href="http://chaijs.com/">Chai</a> with a fluent language for asserting facts about <a href="http://www.slideshare.net/domenicdenicola/callbacks-promises-and-coroutines-oh-my-the-evolution-of-asynchronicity-in-javascript">promises</a>.</p>
<p>Instead of manually wiring up your expectations to a promise's fulfilled and rejected handlers:</p>
<div class="fragment"><div class="line">doSomethingAsync().then(</div>
<div class="line">    function (result) {</div>
<div class="line">        result.should.equal(&quot;foo&quot;);</div>
<div class="line">        done();</div>
<div class="line">    },</div>
<div class="line">    function (err) {</div>
<div class="line">       done(err);</div>
<div class="line">    }</div>
<div class="line">);</div>
</div><!-- fragment --><p>you can write code that expresses what you really mean:</p>
<div class="fragment"><div class="line">return doSomethingAsync().should.eventually.equal(&quot;foo&quot;);</div>
</div><!-- fragment --><p>or if you have a case where <code>return</code> is not preferable (e.g. style considerations) or not possible (e.g. the testing framework doesn't allow returning promises to signal asynchronous test completion), then you can use the following workaround (where <code>done()</code> is supplied by the test framework):</p>
<div class="fragment"><div class="line">doSomethingAsync().should.eventually.equal(&quot;foo&quot;).notify(done);</div>
</div><!-- fragment --><p><em>Notice</em>: either <code>return</code> or <code>notify(done)</code> <em>must</em> be used with promise assertions. This can be a slight departure from the existing format of assertions being used on a project or by a team. Those other assertions are likely synchronous and thus do not require special handling.</p>
<h2><a class="anchor" id="autotoc_md966"></a>
How to Use</h2>
<h3><a class="anchor" id="autotoc_md967"></a>
&lt;tt&gt;should&lt;/tt&gt;/&lt;tt&gt;expect&lt;/tt&gt; Interface</h3>
<p>The most powerful extension provided by Chai as Promised is the <code>eventually</code> property. With it, you can transform any existing Chai assertion into one that acts on a promise:</p>
<div class="fragment"><div class="line">(2 + 2).should.equal(4);</div>
<div class="line"> </div>
<div class="line">// becomes</div>
<div class="line">return Promise.resolve(2 + 2).should.eventually.equal(4);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">expect({ foo: &quot;bar&quot; }).to.have.property(&quot;foo&quot;);</div>
<div class="line"> </div>
<div class="line">// becomes</div>
<div class="line">return expect(Promise.resolve({ foo: &quot;bar&quot; })).to.eventually.have.property(&quot;foo&quot;);</div>
</div><!-- fragment --><p>There are also a few promise-specific extensions (with the usual <code>expect</code> equivalents also available):</p>
<p>```javascript return promise.should.be.fulfilled; return promise.should.eventually.deep.equal("foo"); return promise.should.become("foo"); // same as <code>.eventually.deep.equal</code> return promise.should.be.rejected; return promise.should.be.rejectedWith(Error); // other variants of Chai's <code>throw</code> assertion work too. </p><div class="fragment"><div class="line">### `assert` Interface</div>
<div class="line"> </div>
<div class="line">As with the `should`/`expect` interface, Chai as Promised provides an `eventually` extender to `chai.assert`, allowing any existing Chai assertion to be used on a promise:</div>
<div class="line"> </div>
<div class="line">```javascript</div>
<div class="line">assert.equal(2 + 2, 4, &quot;This had better be true&quot;);</div>
<div class="line"> </div>
<div class="line">// becomes</div>
<div class="line">return assert.eventually.equal(Promise.resolve(2 + 2), 4, &quot;This had better be true, eventually&quot;);</div>
</div><!-- fragment --><p>And there are, of course, promise-specific extensions:</p>
<div class="fragment"><div class="line">return assert.isFulfilled(promise, &quot;optional message&quot;);</div>
<div class="line"> </div>
<div class="line">return assert.becomes(promise, &quot;foo&quot;, &quot;optional message&quot;);</div>
<div class="line">return assert.doesNotBecome(promise, &quot;foo&quot;, &quot;optional message&quot;);</div>
<div class="line"> </div>
<div class="line">return assert.isRejected(promise, &quot;optional message&quot;);</div>
<div class="line">return assert.isRejected(promise, Error, &quot;optional message&quot;);</div>
<div class="line">return assert.isRejected(promise, /error message matcher/, &quot;optional message&quot;);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md968"></a>
Progress Callbacks</h3>
<p>Chai as Promised does not have any intrinsic support for testing promise progress callbacks. The properties you would want to test are probably much better suited to a library like <a href="http://sinonjs.org/">Sinon.JS</a>, perhaps in conjunction with <a href="https://github.com/domenic/sinon-chai">Sinon–Chai</a>:</p>
<div class="fragment"><div class="line">var progressSpy = sinon.spy();</div>
<div class="line"> </div>
<div class="line">return promise.then(null, null, progressSpy).then(function () {</div>
<div class="line">    progressSpy.should.have.been.calledWith(&quot;33%&quot;);</div>
<div class="line">    progressSpy.should.have.been.calledWith(&quot;67%&quot;);</div>
<div class="line">    progressSpy.should.have.been.calledThrice;</div>
<div class="line">});</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md969"></a>
Customizing Output Promises</h3>
<p>By default, the promises returned by Chai as Promised's assertions are regular Chai assertion objects, extended with a single <code>then</code> method derived from the input promise. To change this behavior, for instance to output a promise with more useful sugar methods such as are found in most promise libraries, you can override <code>chaiAsPromised.transferPromiseness</code>. Here's an example that transfer's Q's <code>finally</code> and <code>done</code> methods:</p>
<div class="fragment"><div class="line">chaiAsPromised.transferPromiseness = function (assertion, promise) {</div>
<div class="line">    assertion.then = promise.then.bind(promise); // this is all you get by default</div>
<div class="line">    assertion.finally = promise.finally.bind(promise);</div>
<div class="line">    assertion.done = promise.done.bind(promise);</div>
<div class="line">};</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md970"></a>
Transforming Arguments to the Asserters</h3>
<p>Another advanced customization hook Chai as Promised allows is if you want to transform the arguments to the asserters, possibly asynchronously. Here is a toy example:</p>
<div class="fragment"><div class="line">chaiAsPromised.transformAsserterArgs = function (args) {</div>
<div class="line">    return args.map(function (x) { return x + 1; });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">Promise.resolve(2).should.eventually.equal(2); // will now fail!</div>
<div class="line">Promise.resolve(3).should.eventually.equal(2); // will now pass!</div>
</div><!-- fragment --><p>The transform can even be asynchronous, returning a promise for an array instead of an array directly. An example of that might be using <code>Promise.all</code> so that an array of promises becomes a promise for an array. If you do that, then you can compare promises against other promises using the asserters:</p>
<div class="fragment"><div class="line">// This will normally fail, since within() only works on numbers.</div>
<div class="line">Promise.resolve(2).should.eventually.be.within(Promise.resolve(1), Promise.resolve(6));</div>
<div class="line"> </div>
<div class="line">chaiAsPromised.transformAsserterArgs = function (args) {</div>
<div class="line">    return Promise.all(args);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// But now it will pass, since we transformed the array of promises for numbers into</div>
<div class="line">// (a promise for) an array of numbers</div>
<div class="line">Promise.resolve(2).should.eventually.be.within(Promise.resolve(1), Promise.resolve(6));</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md971"></a>
Compatibility</h3>
<p>Chai as Promised is compatible with all promises following the <a href="http://promisesaplus.com/">Promises/A+ specification</a>.</p>
<p>Notably, jQuery's promises were not up to spec before jQuery 3.0, and Chai as Promised will not work with them. In particular, Chai as Promised makes extensive use of the standard <a href="http://domenic.me/2012/10/14/youre-missing-the-point-of-promises/#toc_2">transformation behavior</a> of <code>then</code>, which jQuery&lt;3.0 does not support.</p>
<p>Angular promises have a special digest cycle for their processing, and <a href="http://stackoverflow.com/a/37374041/3191">need extra setup code to work with Chai as Promised</a>.</p>
<h3><a class="anchor" id="autotoc_md972"></a>
Working with Non-Promise–Friendly Test Runners</h3>
<p>Some test runners (e.g. Jasmine, QUnit, or tap/tape) do not have the ability to use the returned promise to signal asynchronous test completion. If possible, I'd recommend switching to ones that do, such as <a href="http://mochajs.org/#asynchronous-code">Mocha</a>, <a href="http://docs.busterjs.org/en/latest/modules/buster-test/spec/#returning-a-promise">Buster</a>, or <a href="https://github.com/spion/blue-tape">blue-tape</a>. But if that's not an option, Chai as Promised still has you covered. As long as your test framework takes a callback indicating when the asynchronous test run is over, Chai as Promised can adapt to that situation with its <code>notify</code> method, like so:</p>
<div class="fragment"><div class="line">it(&quot;should be fulfilled&quot;, function (done) {</div>
<div class="line">    promise.should.be.fulfilled.and.notify(done);</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line">it(&quot;should be rejected&quot;, function (done) {</div>
<div class="line">    otherPromise.should.be.rejected.and.notify(done);</div>
<div class="line">});</div>
</div><!-- fragment --><p>In these examples, if the conditions are not met, the test runner will receive an error of the form <code>"expected promise to be fulfilled but it was rejected with [Error: error message]"</code>, or <code>"expected promise to be rejected but it was fulfilled."</code></p>
<p>There's another form of <code>notify</code> which is useful in certain situations, like doing assertions after a promise is complete. For example:</p>
<div class="fragment"><div class="line">it(&quot;should change the state&quot;, function (done) {</div>
<div class="line">    otherState.should.equal(&quot;before&quot;);</div>
<div class="line">    promise.should.be.fulfilled.then(function () {</div>
<div class="line">        otherState.should.equal(&quot;after&quot;);</div>
<div class="line">    }).should.notify(done);</div>
<div class="line">});</div>
</div><!-- fragment --><p>Notice how <code>.notify(done)</code> is hanging directly off of <code>.should</code>, instead of appearing after a promise assertion. This indicates to Chai as Promised that it should pass fulfillment or rejection directly through to the testing framework. Thus, the above code will fail with a Chai as Promised error (<code>"expected promise to be fulfilled…"</code>) if <code>promise</code> is rejected, but will fail with a simple Chai error (<code>expected "before" to equal "after"</code>) if <code>otherState</code> does not change.</p>
<h3><a class="anchor" id="autotoc_md973"></a>
Multiple Promise Assertions</h3>
<p>To perform assertions on multiple promises, use <code>Promise.all</code> to combine multiple Chai as Promised assertions:</p>
<div class="fragment"><div class="line">it(&quot;should all be well&quot;, function () {</div>
<div class="line">    return Promise.all([</div>
<div class="line">        promiseA.should.become(&quot;happy&quot;),</div>
<div class="line">        promiseB.should.eventually.have.property(&quot;fun times&quot;),</div>
<div class="line">        promiseC.should.be.rejectedWith(TypeError, &quot;only joyful types are allowed&quot;)</div>
<div class="line">    ]);</div>
<div class="line">});</div>
</div><!-- fragment --><p>This will pass any failures of the individual promise assertions up to the test framework, instead of wrapping them in an <code>"expected promise to be fulfilled…"</code> message as would happen if you did <code>return Promise.all([…]).should.be.fulfilled</code>. If you can't use <code>return</code>, then use <code>.should.notify(done)</code>, similar to the previous examples.</p>
<h2><a class="anchor" id="autotoc_md974"></a>
Installation and Setup</h2>
<h3><a class="anchor" id="autotoc_md975"></a>
Node</h3>
<p>Do an <code>npm install chai-as-promised</code> to get up and running. Then:</p>
<div class="fragment"><div class="line">var chai = require(&quot;chai&quot;);</div>
<div class="line">var chaiAsPromised = require(&quot;chai-as-promised&quot;);</div>
<div class="line"> </div>
<div class="line">chai.use(chaiAsPromised);</div>
<div class="line"> </div>
<div class="line">// Then either:</div>
<div class="line">var expect = chai.expect;</div>
<div class="line">// or:</div>
<div class="line">var assert = chai.assert;</div>
<div class="line">// or:</div>
<div class="line">chai.should();</div>
<div class="line">// according to your preference of assertion style</div>
</div><!-- fragment --><p>You can of course put this code in a common test fixture file; for an example using <a href="http://mochajs.org">Mocha</a>, see <a href="https://github.com/domenic/chai-as-promised/tree/master/test/">the Chai as Promised tests themselves</a>.</p>
<p><b>Note when using other Chai plugins:</b> Chai as Promised finds all currently-registered asserters and promisifies them, at the time it is installed. Thus, you should install Chai as Promised <em>last</em>, after any other Chai plugins, if you expect their asserters to be promisified.</p>
<h3><a class="anchor" id="autotoc_md976"></a>
In the Browser</h3>
<p>To use Chai as Promised in environments that don't support Node.js-like CommonJS modules, you'll need to use a bundling tool like <a href="http://browserify.org/">browserify</a>. See also the note below about browser compatibility.</p>
<h3><a class="anchor" id="autotoc_md977"></a>
Karma</h3>
<p>If you're using <a href="https://karma-runner.github.io/">Karma</a>, check out the accompanying <a href="https://github.com/vlkosinov/karma-chai-as-promised">karma-chai-as-promised</a> plugin.</p>
<h3><a class="anchor" id="autotoc_md978"></a>
Browser/Node Compatibility</h3>
<p>Chai as Promised requires Node v4+ or a browser with equivalent support for modern JavaScript syntax. If your browser doesn't support modern JavaScript syntax, you'll need to transpile it down using a tool like <a href="http://babeljs.io/">Babel</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
