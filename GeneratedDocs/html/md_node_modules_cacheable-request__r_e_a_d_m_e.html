<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EOSDAC: cacheable-request</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EOSDAC
   </div>
   <div id="projectbrief">Open source decentralised DAC platform for EOSIO blockchains</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_node_modules_cacheable-request__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">cacheable-request </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p>Wrap native HTTP requests with RFC compliant cache support </p>
</blockquote>
<p><a href="https://travis-ci.org/lukechilds/cacheable-request"><img src="https://travis-ci.org/lukechilds/cacheable-request.svg?branch=master" alt="Build Status" style="pointer-events: none;" class="inline"/></a> <a href="https://coveralls.io/github/lukechilds/cacheable-request?branch=master"><img src="https://coveralls.io/repos/github/lukechilds/cacheable-request/badge.svg?branch=master" alt="Coverage Status" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/cacheable-request"><img src="https://img.shields.io/npm/dm/cacheable-request.svg" alt="npm" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/cacheable-request"><img src="https://img.shields.io/npm/v/cacheable-request.svg" alt="npm" style="pointer-events: none;" class="inline"/></a></p>
<p><a href="http://httpwg.org/specs/rfc7234.html">RFC 7234</a> compliant HTTP caching for native Node.js HTTP/HTTPS requests. Caching works out of the box in memory or is easily pluggable with a wide range of storage adapters.</p>
<p><b>Note:</b> This is a low level wrapper around the core HTTP modules, it's not a high level request library.</p>
<h1><a class="anchor" id="autotoc_md774"></a>
Features</h1>
<ul>
<li>Only stores cacheable responses as defined by RFC 7234</li>
<li>Fresh cache entries are served directly from cache</li>
<li>Stale cache entries are revalidated with <code>If-None-Match</code>/<code>If-Modified-Since</code> headers</li>
<li>304 responses from revalidation requests use cached body</li>
<li>Updates <code>Age</code> header on cached responses</li>
<li>Can completely bypass cache on a per request basis</li>
<li>In memory cache by default</li>
<li>Official support for Redis, MongoDB, SQLite, PostgreSQL and MySQL storage adapters</li>
<li>Easily plug in your own or third-party storage adapters</li>
<li>If DB connection fails, cache is automatically bypassed (<a href="#optsautomaticfailover">disabled by default</a>)</li>
<li>Adds cache support to any existing HTTP code with minimal changes</li>
<li>Uses <a href="https://github.com/pornel/http-cache-semantics">http-cache-semantics</a> internally for HTTP RFC 7234 compliance</li>
</ul>
<h1><a class="anchor" id="autotoc_md775"></a>
Install</h1>
<div class="fragment"><div class="line">npm install cacheable-request</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md776"></a>
Usage</h1>
<div class="fragment"><div class="line">const http = require(&#39;http&#39;);</div>
<div class="line">const CacheableRequest = require(&#39;cacheable-request&#39;);</div>
<div class="line"> </div>
<div class="line">// Then instead of</div>
<div class="line">const req = http.request(&#39;http://example.com&#39;, cb);</div>
<div class="line">req.end();</div>
<div class="line"> </div>
<div class="line">// You can do</div>
<div class="line">const cacheableRequest = new CacheableRequest(http.request);</div>
<div class="line">const cacheReq = cacheableRequest(&#39;http://example.com&#39;, cb);</div>
<div class="line">cacheReq.on(&#39;request&#39;, req =&gt; req.end());</div>
<div class="line">// Future requests to &#39;example.com&#39; will be returned from cache if still valid</div>
<div class="line"> </div>
<div class="line">// You pass in any other http.request API compatible method to be wrapped with cache support:</div>
<div class="line">const cacheableRequest = new CacheableRequest(https.request);</div>
<div class="line">const cacheableRequest = new CacheableRequest(electron.net);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md777"></a>
Storage Adapters</h1>
<p><code>cacheable-request</code> uses <a href="https://github.com/lukechilds/keyv">Keyv</a> to support a wide range of storage adapters.</p>
<p>For example, to use Redis as a cache backend, you just need to install the official Redis Keyv storage adapter:</p>
<div class="fragment"><div class="line">npm install @keyv/redis</div>
</div><!-- fragment --><p>And then you can pass <code>CacheableRequest</code> your connection string:</p>
<div class="fragment"><div class="line">const cacheableRequest = new CacheableRequest(http.request, &#39;redis://user:pass@localhost:6379&#39;);</div>
</div><!-- fragment --><p><a href="https://github.com/lukechilds/keyv#official-storage-adapters">View all official Keyv storage adapters.</a></p>
<p>Keyv also supports anything that follows the Map API so it's easy to write your own storage adapter or use a third-party solution.</p>
<p>e.g The following are all valid storage adapters</p>
<div class="fragment"><div class="line">const storageAdapter = new Map();</div>
<div class="line">// or</div>
<div class="line">const storageAdapter = require(&#39;./my-storage-adapter&#39;);</div>
<div class="line">// or</div>
<div class="line">const QuickLRU = require(&#39;quick-lru&#39;);</div>
<div class="line">const storageAdapter = new QuickLRU({ maxSize: 1000 });</div>
<div class="line"> </div>
<div class="line">const cacheableRequest = new CacheableRequest(http.request, storageAdapter);</div>
</div><!-- fragment --><p>View the <a href="https://github.com/lukechilds/keyv">Keyv docs</a> for more information on how to use storage adapters.</p>
<h1><a class="anchor" id="autotoc_md778"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md779"></a>
new cacheableRequest(request, [storageAdapter])</h2>
<p>Returns the provided request function wrapped with cache support.</p>
<h3><a class="anchor" id="autotoc_md780"></a>
request</h3>
<p>Type: <code>function</code></p>
<p>Request function to wrap with cache support. Should be <a href="https://nodejs.org/api/http.html#http_http_request_options_callback"><code>http.request</code></a> or a similar API compatible request function.</p>
<h3><a class="anchor" id="autotoc_md781"></a>
storageAdapter</h3>
<p>Type: <code>Keyv storage adapter</code><br  />
 Default: <code>new Map()</code></p>
<p>A <a href="https://github.com/lukechilds/keyv">Keyv</a> storage adapter instance, or connection string if using with an official Keyv storage adapter.</p>
<h2><a class="anchor" id="autotoc_md782"></a>
Instance</h2>
<h3><a class="anchor" id="autotoc_md783"></a>
cacheableRequest(opts, [cb])</h3>
<p>Returns an event emitter.</p>
<h4><a class="anchor" id="autotoc_md784"></a>
opts</h4>
<p>Type: <code>object</code>, <code>string</code></p>
<ul>
<li>Any of the default request functions options.</li>
<li>Any <a href="https://github.com/kornelski/http-cache-semantics#constructor-options"><code>http-cache-semantics</code></a> options.</li>
<li>Any of the following:</li>
</ul>
<h5>opts.cache</h5>
<p>Type: <code>boolean</code><br  />
 Default: <code>true</code></p>
<p>If the cache should be used. Setting this to false will completely bypass the cache for the current request.</p>
<h5>opts.strictTtl</h5>
<p>Type: <code>boolean</code><br  />
 Default: <code>false</code></p>
<p>If set to <code>true</code> once a cached resource has expired it is deleted and will have to be re-requested.</p>
<p>If set to <code>false</code> (default), after a cached resource's TTL expires it is kept in the cache and will be revalidated on the next request with <code>If-None-Match</code>/<code>If-Modified-Since</code> headers.</p>
<h5>opts.maxTtl</h5>
<p>Type: <code>number</code><br  />
 Default: <code>undefined</code></p>
<p>Limits TTL. The <code>number</code> represents milliseconds.</p>
<h5>opts.automaticFailover</h5>
<p>Type: <code>boolean</code><br  />
 Default: <code>false</code></p>
<p>When set to <code>true</code>, if the DB connection fails we will automatically fallback to a network request. DB errors will still be emitted to notify you of the problem even though the request callback may succeed.</p>
<h5>opts.forceRefresh</h5>
<p>Type: <code>boolean</code><br  />
 Default: <code>false</code></p>
<p>Forces refreshing the cache. If the response could be retrieved from the cache, it will perform a new request and override the cache instead.</p>
<h4><a class="anchor" id="autotoc_md785"></a>
cb</h4>
<p>Type: <code>function</code></p>
<p>The callback function which will receive the response as an argument.</p>
<p>The response can be either a <a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage">Node.js HTTP response stream</a> or a <a href="https://github.com/lukechilds/responselike">responselike object</a>. The response will also have a <code>fromCache</code> property set with a boolean value.</p>
<h4><a class="anchor" id="autotoc_md786"></a>
.on('request', request)</h4>
<p><code>request</code> event to get the request object of the request.</p>
<p><b>Note:</b> This event will only fire if an HTTP request is actually made, not when a response is retrieved from cache. However, you should always handle the <code>request</code> event to end the request and handle any potential request errors.</p>
<h4><a class="anchor" id="autotoc_md787"></a>
.on('response', response)</h4>
<p><code>response</code> event to get the response object from the HTTP request or cache.</p>
<h4><a class="anchor" id="autotoc_md788"></a>
.on('error', error)</h4>
<p><code>error</code> event emitted in case of an error with the cache.</p>
<p>Errors emitted here will be an instance of <code>CacheableRequest.RequestError</code> or <code>CacheableRequest.CacheError</code>. You will only ever receive a <code>RequestError</code> if the request function throws (normally caused by invalid user input). Normal request errors should be handled inside the <code>request</code> event.</p>
<p>To properly handle all error scenarios you should use the following pattern:</p>
<div class="fragment"><div class="line">cacheableRequest(&#39;example.com&#39;, cb)</div>
<div class="line">  .on(&#39;error&#39;, err =&gt; {</div>
<div class="line">    if (err instanceof CacheableRequest.CacheError) {</div>
<div class="line">      handleCacheError(err); // Cache error</div>
<div class="line">    } else if (err instanceof CacheableRequest.RequestError) {</div>
<div class="line">      handleRequestError(err); // Request function thrown</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">  .on(&#39;request&#39;, req =&gt; {</div>
<div class="line">    req.on(&#39;error&#39;, handleRequestError); // Request error emitted</div>
<div class="line">    req.end();</div>
<div class="line">  });</div>
</div><!-- fragment --><p><b>Note:</b> Database connection errors are emitted here, however <code>cacheable-request</code> will attempt to re-request the resource and bypass the cache on a connection error. Therefore a database connection error doesn't necessarily mean the request won't be fulfilled.</p>
<h1><a class="anchor" id="autotoc_md789"></a>
License</h1>
<p>MIT © Luke Childs </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
